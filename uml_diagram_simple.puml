@startuml

title Платформа "ЧёПочём" - Логическая модель данных

class Роль {
  + id : INT [PK]
  + название : VARCHAR(50) [UNIQUE]
  + описание : TEXT
  + дата_создания : TIMESTAMP
}

class Пользователь {
  + id : INT [PK]
  + имя_пользователя : VARCHAR(50) [UNIQUE]
  + email : VARCHAR(255) [UNIQUE]
  + хеш_пароля : VARCHAR(255)
  + имя : VARCHAR(100)
  + фамилия : VARCHAR(100)
  + телефон : VARCHAR(20)
  + url_аватара : TEXT
  + верифицирован : BOOLEAN
  + активен : BOOLEAN
  + id_роли : INT [FK]
  + дата_создания : TIMESTAMP
  + дата_обновления : TIMESTAMP
  + последний_вход : TIMESTAMP
}

class Профиль_Пользователя {
  + id : INT [PK]
  + id_пользователя : INT [FK]
  + биография : TEXT
  + местоположение : VARCHAR(255)
  + дата_рождения : DATE
  + пол : VARCHAR(20)
  + веб_сайт : TEXT
  + дата_создания : TIMESTAMP
  + дата_обновления : TIMESTAMP
}

class Репутация_Пользователя {
  + id : INT [PK]
  + id_пользователя : INT [FK]
  + общий_балл : INT
  + положительные_отзывы : INT
  + отрицательные_отзывы : INT
  + нейтральные_отзывы : INT
  + уровень_репутации : VARCHAR(20)
  + дата_создания : TIMESTAMP
  + дата_обновления : TIMESTAMP
}

class Отзыв {
  + id : INT [PK]
  + id_автора_отзыва : INT [FK]
  + id_оцениваемого_пользователя : INT [FK]
  + рейтинг : INT [1-5]
  + комментарий : TEXT
  + положительный : BOOLEAN
  + дата_создания : TIMESTAMP
  + дата_обновления : TIMESTAMP
}

class Категория {
  + id : INT [PK]
  + название : VARCHAR(100)
  + slug : VARCHAR(100) [UNIQUE]
  + описание : TEXT
  + иконка : VARCHAR(50)
  + id_родительской_категории : INT [FK]
  + активна : BOOLEAN
  + порядок_сортировки : INT
  + дата_создания : TIMESTAMP
}

class Объявление {
  + id : INT [PK]
  + id_пользователя : INT [FK]
  + id_категории : INT [FK]
  + заголовок : VARCHAR(255)
  + описание : TEXT
  + цена : DECIMAL(12,2)
  + валюта : VARCHAR(3)
  + состояние : VARCHAR(20)
  + статус : VARCHAR(20)
  + местоположение : VARCHAR(255)
  + широта : DECIMAL(10,8)
  + долгота : DECIMAL(11,8)
  + торг_возможен : BOOLEAN
  + срочно : BOOLEAN
  + количество_просмотров : INT
  + количество_избранных : INT
  + дата_создания : TIMESTAMP
  + дата_обновления : TIMESTAMP
  + дата_публикации : TIMESTAMP
  + дата_истечения : TIMESTAMP
}

class Изображение_Объявления {
  + id : INT [PK]
  + id_объявления : INT [FK]
  + url_изображения : TEXT
  + url_миниатюры : TEXT
  + альтернативный_текст : VARCHAR(255)
  + порядок_сортировки : INT
  + основное_изображение : BOOLEAN
  + дата_создания : TIMESTAMP
}

class Избранное_Пользователя {
  + id : INT [PK]
  + id_пользователя : INT [FK]
  + id_объявления : INT [FK]
  + дата_создания : TIMESTAMP
}

class Жалоба {
  + id : INT [PK]
  + id_жалобщика : INT [FK]
  + id_жалуемого_пользователя : INT [FK]
  + id_жалуемого_объявления : INT [FK]
  + тип_жалобы : VARCHAR(50)
  + описание : TEXT
  + статус : VARCHAR(20)
  + id_модератора : INT [FK]
  + решение : TEXT
  + дата_создания : TIMESTAMP
  + дата_решения : TIMESTAMP
}

class Модерация_Объявления {
  + id : INT [PK]
  + id_объявления : INT [FK]
  + id_модератора : INT [FK]
  + действие : VARCHAR(20)
  + причина : TEXT
  + дата_создания : TIMESTAMP
}

class Уведомление {
  + id : INT [PK]
  + id_пользователя : INT [FK]
  + тип : VARCHAR(50)
  + заголовок : VARCHAR(255)
  + содержимое : TEXT
  + прочитано : BOOLEAN
  + тип_связанной_сущности : VARCHAR(50)
  + id_связанной_сущности : INT
  + дата_создания : TIMESTAMP
}

class Статистика_Пользователя {
  + id : INT [PK]
  + id_пользователя : INT [FK]
  + количество_объявлений : INT
  + количество_проданных : INT
  + количество_купленных : INT
  + общий_доход : DECIMAL(12,2)
  + общие_траты : DECIMAL(12,2)
  + процент_ответов : DECIMAL(5,2)
  + среднее_время_ответа : INT
  + дата_создания : TIMESTAMP
  + дата_обновления : TIMESTAMP
}

' Связи между сущностями
Пользователь ||--o{ Профиль_Пользователя : "имеет"
Пользователь ||--o{ Репутация_Пользователя : "имеет"
Пользователь ||--o{ Статистика_Пользователя : "имеет"
Пользователь ||--o{ Объявление : "создает"
Пользователь ||--o{ Отзыв : "оставляет"
Пользователь ||--o{ Отзыв : "получает"
Пользователь ||--o{ Избранное_Пользователя : "добавляет"
Пользователь ||--o{ Жалоба : "подает"
Пользователь ||--o{ Жалоба : "получает"
Пользователь ||--o{ Модерация_Объявления : "выполняет"
Пользователь ||--o{ Уведомление : "получает"

Роль ||--o{ Пользователь : "назначается"

Категория ||--o{ Категория : "подкатегория"
Категория ||--o{ Объявление : "содержит"

Объявление ||--o{ Изображение_Объявления : "содержит"
Объявление ||--o{ Избранное_Пользователя : "добавляется_в"
Объявление ||--o{ Жалоба : "жалуется_на"
Объявление ||--o{ Модерация_Объявления : "модерируется"

@enduml
